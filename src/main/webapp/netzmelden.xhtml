<!DOCTYPE html>
<ui:composition template="/templates/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <!-- Seitentitel für Layout -->
    <ui:define name="title">Geisternetze erfassen</ui:define>

    <ui:define name="content">
    	<div class="page-container">
    
            <!-- Hauptüberschrift -->
		    <h2 class="home-title">Geisternetze erfassen</h2>
		    
            <!-- Growl für Fehlermeldungen -->
			<p:growl id="growl" showDetail="true" life="3500" />
			
		    <h:form id="netForm">
                <!-- PanelGrid für Formulareingaben -->	
		        <h:panelGrid columns="3" cellpadding="5" columnClasses="label-column, input-column, error-column">
		            <p:outputLabel value="Breitengrad" for="latitude"/>
					<h:panelGroup layout="block" style="display: flex; align-items: center; gap: 10px;">
                        <p:inputText id="latitude" 
                        			 value="#{netBean.net.latitude}" 
                        			 required="true" 
                        			 requiredMessage="Breitengrad erforderlich" 
                  					 validatorMessage="Breitengrad muss zwischen -90 und +90 liegen."
                        			 placeholder="z. B. 52.1234">
                        	<f:validateDoubleRange minimum="-90" maximum="90"/>
                        </p:inputText>
                    </h:panelGroup>		   
                    <p:message for="latitude" display="text" />
                             
		            <p:outputLabel value="Längengrad" for="longitude"/>
					<h:panelGroup layout="block" style="display: flex; align-items: center; gap: 10px;">
                        <p:inputText id="longitude" 
                        			 value="#{netBean.net.longitude}" 
                        			 required="true" 
									 requiredMessage="Längengrad erforderlich"
									 validatorMessage="Längengrad muss zwischen -180 und +180 liegen."
                        			 placeholder="z. B. 13.5678">
                        	<f:validateDoubleRange minimum="-180" maximum="180"/>
                        </p:inputText>
                    </h:panelGroup>
					<p:message for="longitude" display="text" />
	
					<p:outputLabel value="Size" for="size"/>
					<h:panelGroup layout="block" style="display: flex; align-items: center; gap: 10px;">
                        <p:selectOneMenu id="size" 
                        				 value="#{netBean.selectedSizeId}" 
                        				 required="true" 
                        				 requiredMessage="Größe erforderlich">
                            <f:selectItem itemValue="" itemLabel="Auswählen..." />
                            <f:selectItems value="#{netBean.allSizes}" var="s" itemValue="#{s.id}" itemLabel="#{s.name}" />
                        </p:selectOneMenu>
                    </h:panelGroup>
                    <p:message for="size" display="text" />
                    
					<h:outputText id="anonymousLabel" value="Meldung anonym speichern" />
					<p:selectBooleanCheckbox id="anonymous" value="#{netBean.anonymous}" 
					    rendered="#{empty netBean.reporter.firstName and empty netBean.reporter.lastName and empty netBean.reporter.phone}">
					    <p:ajax event="change" update="personalPanel" listener="#{netBean.clearPersonalIfAnonym}" />
					</p:selectBooleanCheckbox>
					<p:outputLabel value="" for=""/>
					                    	
		        </h:panelGrid>   

                <!-- Persönliche Daten -->
		        <h:panelGrid id="personalPanel" columns="3" cellpadding="5" columnClasses="label-column, input-column, error-column">
                    <p:outputLabel value="Vorname" for="reporterFirstName"/>
					<p:inputText id="reporterFirstName" 
								 value="#{netBean.reporter.firstName}" 
								 placeholder="Optional" 
								 disabled="#{netBean.anonymous}" 
								 required="#{!netBean.anonymous}" 
								 requiredMessage="Vorname erforderlich bei nicht-anonymer Meldung" />
					<p:message for="reporterFirstName" display="text" />
					
					<p:outputLabel value="Nachname" for="reporterLastName"/>
					<p:inputText id="reporterLastName" 
								 value="#{netBean.reporter.lastName}" 
								 placeholder="Optional"
								 disabled="#{netBean.anonymous}" 
								 required="#{!netBean.anonymous}" 
								 requiredMessage="Nachname erforderlich bei nicht-anonymer Meldung" />
					<p:message for="reporterLastName" display="text" />
					
					<p:outputLabel value="Telefonnummer" for="reporterPhone"/>
					<p:inputText id="reporterPhone" 
								 value="#{netBean.reporter.phone}" 
								 placeholder="Optional"
								 disabled="#{netBean.anonymous}" 
								 required="#{!netBean.anonymous}" 
								 requiredMessage="Telefonnummer erforderlich bei nicht-anonymer Meldung">
					    <f:validator validatorId="phoneValidator" />
					</p:inputText>
					<p:message for="reporterPhone" display="text" />
					
					<h:outputText />
					<p:commandButton value="Speichern" 
									 icon="pi pi-save" 
									 action="#{netBean.reportNewNet}" 
									 update="netTable netForm growl" 
									 process="@form" 
									 style="margin-top: 10px;"/>
		        </h:panelGrid>   
		    </h:form>
		
            <!-- Tabelle aller Geisternetze -->
		    <h3 class="home-section-title">Alle Geisternetze:</h3>
		    <p:dataTable id="netTable" 
		    			 value="#{netBean.allNets}" 
		    			 var="n" 
		    			 paginator="true" 
		    			 rows="10"
			    		 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
	                     rowsPerPageTemplate="5,10,20,50"
	                     rowsPerPageDropdown="true"
	                     emptyMessage="Keine Geisternetze gefunden">
				<p:column headerText="ID" sortBy="#{n.id}">#{n.id}</p:column>
                <p:column headerText="Latitude" sortBy="#{n.latitude}">#{n.latitude}</p:column>
                <p:column headerText="Longitude" sortBy="#{n.longitude}">#{n.longitude}</p:column>
                <p:column headerText="Größe" sortBy="#{n.size.name}">#{n.size.name}</p:column>
                <p:column headerText="Status" sortBy="#{n.status.name}">#{n.status.name}</p:column>
                <p:column headerText="Gemeldet" sortBy="#{n.reportedAt}">#{n.formattedReportedAt}</p:column>
	        </p:dataTable>
		</div>
    </ui:define>
</ui:composition>